server.modules += ("mod_setenv", "mod_rewrite", "mod_proxy", "mod_redirect", "mod_access", "mod_cgi")

$HTTP["host"] =~ "^torwuf\.com$" { 
	url.redirect = ( "^/(.*)" => "http://www.torwuf.com/$1" ) 
}

# corenetworks dns config:
$HTTP["host"] =~ "^mail\.torwuf\.com$" { 
	url.redirect = ( "^/(.*)" => "http://www.torwuf.com/$1" ) 
}

$HTTP["host"] =~ "(^|\.)torwuf\.com$" {
	$SERVER["socket"] == ":443" {
		ssl.engine = "enable"
		ssl.pemfile = "/etc/torwuf/server.pem"
	}
	
	server.document-root = "/home/www-torwuf/torwuf-service/www/"
	server.dir-listing = "enable"
	server.groupname = "www-torwuf"
	server.follow-symlink="enable"
	alias.url = ( "/z/r/" => "/usr/share/torwuf-data/static/" )
	
	$HTTP["url"] =~ "^/z($|/)" {
		dir-listing.activate = "enable" 
		mimetype.assign+=(".php"=>"text/html",""=>"text/html")
		static-file.exclude-extensions = ()
		index-file.names = ( "dummy.asdf" )
	}
	
	$HTTP["url"] !~ "^/(favicon.ico$|robots.txt$|google([a-z0-9]+)\.html$|compfacts|z($|/))" {
		proxy.server = (
			"" => (
				("host"=>"127.0.0.1", "port"=>8797)
			)
		)
	}
	
	$HTTP["url"] =~ "^/compfacts" {
		proxy.server = (
			"" => (
				("host"=>"127.0.0.1", "port"=>8795)
			)
		)
	}
	
	$HTTP["url"] =~ "^/z/kitabyte/.*woff$" {
		setenv.add-response-header = ( "Access-Control-Allow-Origin" => "*")
	}
}

